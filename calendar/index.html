<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>菜々カレンダー</title>

<style>
:root{
  --paper:#ffffff;
  --ink:#111;
  --grid:#c7cdd4;
  --band:#d85c61;
  --band2:#c94d53;
  --sun:#d04545;
  --sat:#2f6bff;
}

/* ===== 背景（木目） ===== */
body{
  margin:0;
  font-family: system-ui,-apple-system,"Noto Sans JP",sans-serif;
  background:
    linear-gradient(90deg,#caa67b,#b88f63),
    repeating-linear-gradient(90deg,
      rgba(120,80,40,.2) 0px,
      rgba(120,80,40,.2) 3px,
      rgba(140,95,50,.15) 3px,
      rgba(140,95,50,.15) 8px);
}

.wrap{max-width:980px;margin:auto;padding:16px}
.sheet{
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 15px 45px rgba(0,0,0,.2)
}

/* ===== 上帯 ===== */
.band{
  display:flex;
  justify-content:center;
  gap:14px;
  padding:14px;
  background:linear-gradient(var(--band),var(--band2));
  color:#fff;
  font-weight:900;
}
.band-month{
  font-size:32px;
  color:#ffd56b;
}
.band-title{font-size:32px}

/* ===== 曜日 ===== */
.dow{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  background:#fafafa;
  border-bottom:1px solid var(--grid);
  font-weight:900;
}
.dow div{
  text-align:center;
  padding:8px 0;
  border-right:1px solid var(--grid);
}
.dow div:last-child{border-right:none}
.sun{color:var(--sun)}
.sat{color:var(--sat)}

/* ===== カレンダー ===== */
.grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  grid-auto-rows:70px;
}
.cell{
  position:relative;
  border-right:1px solid var(--grid);
  border-bottom:1px solid var(--grid);
  padding:6px;
}
.cell:nth-child(7n){border-right:none}
.day{font-size:22px;font-weight:900}

/* ===== 休 ===== */
.off{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:42px;
  color:#d24a4a;
  font-weight:1000;
}

/* ===== スタンプ2倍（ズレ対策版） ===== */
.noteTag{
  position:absolute;
  right:6px;
  bottom:6px;
  font-size:13px;
  font-weight:900;
  color:#a04a4a;
  transform:rotate(-8deg);
  white-space:pre;
  text-align:right;
}

/* ===== 下部 ===== */
.foot{padding:14px}
.hours{display:flex;gap:10px;align-items:flex-end}
.hours-label{font-weight:900}
.hours-time{font-size:52px;font-weight:1000}
.shoprow{
  margin-top:8px;
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
}
.shopname{font-size:40px;font-weight:1000}
.telbadge{
  background:#333;color:#fff;
  padding:6px 10px;border-radius:6px;
  font-size:12px;font-weight:900;
}
.tel .num{font-size:26px;font-weight:1000}

/* ===== ボタン ===== */
.bars{
  margin-top:12px;
  display:flex;
  justify-content:center;
  gap:8px;
  flex-wrap:wrap;
}
button{
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ccc;
  background:#fff;
  font-weight:900;
}

/* ===== A4印刷 ===== */
@page{size:A4 portrait;margin:6mm}
@media print{
  body{background:#fff}
  .bars{display:none}
  .sheet{
    width:198mm;
    height:285mm;
    box-shadow:none;
    border-radius:0;
  }
  .grid{height:150mm}
}
</style>
</head>

<body>
<main class="wrap">

<section class="sheet">

<div class="band">
<div class="band-month" id="bandMonth"></div>
<div class="band-title">菜々カレンダー</div>
</div>

<div class="dow">
<div class="sun">日</div><div>月</div><div>火</div>
<div>水</div><div>木</div><div>金</div><div class="sat">土</div>
</div>

<div class="grid" id="grid"></div>

<div class="foot">
<div class="hours">
<div class="hours-label">営業時間</div>
<div class="hours-time">11:00 ～ 19:30 (L.O.)</div>
</div>

<div class="shoprow">
<div class="shopname">たこ焼き 菜々</div>
<div>
<div class="telbadge">電話予約受付ます</div>
<div class="tel">TEL <span class="num">070-4077-7732</span></div>
</div>
</div>
</div>

</section>

<div class="bars">
<button onclick="change(-1)">←先月</button>
<button onclick="today()">今月</button>
<button onclick="change(1)">来月→</button>
<button onclick="window.print()">A4で印刷</button>
</div>

</main>

<script>
let now=new Date()
let viewY=now.getFullYear()
let viewM=now.getMonth()+1

function pad(n){return String(n).padStart(2,"0")}

function baseOff(y,m,d){
const dt=new Date(y,m-1,d)
const dow=dt.getDay()

if(dow===3)return true //水曜

if(dow===4){
let count=0
for(let i=1;i<=d;i++){
if(new Date(y,m-1,i).getDay()===4)count++
}
return count===2||count===3
}
return false
}

function stamp(d){return d===7||d===17||d===27}

async function render(){
document.getElementById("bandMonth").textContent=viewM+"月"
const grid=document.getElementById("grid")
grid.innerHTML=""

let data={overrides:{}}
try{
const r=await fetch("assets/calendar-data.json",{cache:"no-store"})
if(r.ok)data=await r.json()
}catch{}

const key=viewY+"-"+pad(viewM)
const ov=data.overrides[key]||{}
const offSet=new Set(ov.off||{})
const tags=ov.tags||{}

const first=new Date(viewY,viewM-1,1).getDay()
const last=new Date(viewY,viewM,0).getDate()

for(let i=0;i<first;i++){
grid.innerHTML+='<div class="cell"></div>'
}

for(let d=1;d<=last;d++){
const date=viewY+"-"+pad(viewM)+"-"+pad(d)
let html='<div class="cell '+(new Date(viewY,viewM-1,d).getDay()===0?'sun':'')+'">'
html+='<div class="day">'+d+'</div>'

const off=baseOff(viewY,viewM,d)||offSet.has(date)

if(off){
html+='<div class="off">休</div>'
}else{
let t=tags[date]||(stamp(d)?"スタンプ\n2倍":"")
if(t)html+='<div class="noteTag">'+t+'</div>'
}

html+='</div>'
grid.innerHTML+=html
}

while(grid.children.length%7!==0){
grid.innerHTML+='<div class="cell"></div>'
}
}

function change(v){
viewM+=v
if(viewM<1){viewM=12;viewY--}
if(viewM>12){viewM=1;viewY++}
render()
}

function today(){
viewY=now.getFullYear()
viewM=now.getMonth()+1
render()
}

render()
</script>

</body>
</html>